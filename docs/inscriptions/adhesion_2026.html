<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>Adhésion 2026 – Crécyvélo 77</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
@page{size:A4;margin:10mm}
body{font-family:Arial,sans-serif;background:#eee;margin:0}
.page{width:210mm;margin:auto;background:#fff;padding:14px}
fieldset{border:1px solid #aaa;border-radius:8px;margin:10px 0;padding:10px}
legend{font-weight:bold}
label{font-weight:bold;display:block;margin-top:6px}
input,select{width:100%;padding:6px;border-radius:6px;border:1px solid #ccc}
.choices{display:flex;gap:14px;flex-wrap:wrap}
.pill{display:flex;gap:6px;align-items:center}
table{width:100%;border-collapse:collapse}
td,th{border:1px solid #ccc;padding:4px}
.btn{padding:10px 16px;border-radius:8px;border:0;font-weight:bold;cursor:pointer}
.btn-primary{background:#1c8f4a;color:#fff}
.btn-ghost{background:#ddd}
.hidden{display:none}
canvas{border:1px solid #666}
</style>
</head>

<body>
<div class="page" id="formPage">

<h2>Bulletin d’adhésion 2026 – Crécyvélo 77</h2>

<form id="adhesionForm">

<fieldset>
<legend>Type d’adhésion</legend>
<div class="choices">
<label class="pill"><input type="radio" name="type_adhesion" value="renouvellement" required>Renouvellement</label>
<label class="pill"><input type="radio" name="type_adhesion" value="premiere">Première adhésion</label>
</div>
</fieldset>

<fieldset>
<legend>Identité</legend>
<label>Civilité</label>
<div class="choices">
<label class="pill"><input type="radio" name="civilite" value="Madame" required>Madame</label>
<label class="pill"><input type="radio" name="civilite" value="Monsieur">Monsieur</label>
</div>

<label>Nom</label><input name="nom" required>
<label>Prénom</label><input name="prenom" required>
<label>Nom de naissance</label><input name="nom_naissance">
<label>Date de naissance</label><input type="date" name="date_naissance" required>
<label>Commune de naissance</label><input name="commune_naissance" required>
<label>Département de naissance</label><input name="departement_naissance">
<label>Pays de naissance</label>
<select name="pays_naissance"><option>France</option><option>Etranger</option></select>
<label>N° licence (6 chiffres)</label><input name="licence">
</fieldset>

<fieldset>
<legend>Coordonnées</legend>
<label>Adresse</label><input name="adresse" required>
<label>CP</label><input name="cp" required>
<label>Ville</label><input name="ville" required>
<label>Téléphone</label><input name="telephone" required>
<label>Email</label><input type="email" name="email" required>
</fieldset>

<fieldset>
<legend>Informations sportives</legend>
<label>Pratique</label>
<div class="choices">
<label class="pill"><input type="checkbox" name="pratique" value="Route">Route</label>
<label class="pill"><input type="checkbox" name="pratique" value="VTT">VTT</label>
<label class="pill"><input type="checkbox" name="pratique" value="Gravel">Gravel</label>
</div>

<label>VAE</label>
<div class="choices">
<label class="pill"><input type="radio" name="vae" value="Oui" required>Oui</label>
<label class="pill"><input type="radio" name="vae" value="Non">Non</label>
</div>
</fieldset>

<fieldset>
<legend>Mode de règlement</legend>
<div class="choices">
<label class="pill"><input type="radio" name="reglement" value="Virement" required>Virement</label>
<label class="pill"><input type="radio" name="reglement" value="Chèque">Chèque</label>
<label class="pill"><input type="radio" name="reglement" value="CB (TPE)">CB (TPE)</label>
<label class="pill"><input type="radio" name="reglement" value="Espèces">Espèces</label>
</div>
</fieldset>

<fieldset>
<legend>Signature</legend>
<canvas id="sig" width="400" height="120"></canvas>
<button type="button" class="btn btn-ghost" id="clearSig">Effacer</button>
<input type="hidden" id="signature_data">
</fieldset>

<fieldset>
<label class="pill">
<input type="checkbox" id="sante_ack" required>
Attestation santé validée
</label>
</fieldset>

<button class="btn btn-primary" type="submit">Envoyer l’adhésion</button>
</form>
</div>

<div class="page hidden" id="confirmPage">
<h2>✅ Inscription enregistrée</h2>
<p>Merci pour votre inscription.</p>
<p><b>N° d’adhésion :</b> <span id="numAdh"></span></p>
<a id="pdfLink" class="btn btn-primary" target="_blank">Télécharger le PDF</a>
</div>

<script>
const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyFote2couQvnAFGuZ0A84nGnyGBfJtpZlddwLfZ8Qb1PMeWlad8u6H9biiTz8ubIko1w/exec";

/* Signature */
(()=>{
const c=document.getElementById("sig"),ctx=c.getContext("2d");
let d=false;
c.onmousedown=e=>{d=true;ctx.beginPath();ctx.moveTo(e.offsetX,e.offsetY)}
c.onmousemove=e=>{if(d){ctx.lineTo(e.offsetX,e.offsetY);ctx.stroke()}}
c.onmouseup=()=>d=false;
document.getElementById("clearSig").onclick=()=>ctx.clearRect(0,0,c.width,c.height);
document.getElementById("adhesionForm").onsubmit=async e=>{
e.preventDefault();
document.getElementById("signature_data").value=c.toDataURL();
const f=e.target;
const payload={
nom:f.nom.value,prenom:f.prenom.value,nom_naissance:f.nom_naissance.value,
type_adhesion:f.type_adhesion.value,civilite:f.civilite.value,
date_naissance:f.date_naissance.value,commune_naissance:f.commune_naissance.value,
departement_naissance:f.departement_naissance.value,
pays_naissance:f.pays_naissance.value,licence:f.licence.value,
adresse:f.adresse.value,cp:f.cp.value,ville:f.ville.value,
telephone:f.telephone.value,email:f.email.value,
pratique:[...f.querySelectorAll('input[name="pratique"]:checked')].map(x=>x.value),
vae:f.vae.value,reglement:f.reglement.value,
signature:{dataUrl:document.getElementById("signature_data").value},
sante_ack:document.getElementById("sante_ack").checked
};
const r=await fetch(APPS_SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain"},body:JSON.stringify(payload)});
const j=await r.json();
document.getElementById("formPage").classList.add("hidden");
document.getElementById("confirmPage").classList.remove("hidden");
document.getElementById("numAdh").textContent=j.adhesionNumber;
document.getElementById("pdfLink").href=j.pdfUrl;
};
})();
</script>
</body>
</html>
